syntax = "proto3";

package bgs.protocol.friends.v1;

// Java generation options
option java_package = "br.net.dd.netherwingcore.proto.client";
option java_outer_classname = "FriendsServiceProto";
option optimize_for = CODE_SIZE;

import "br/net/dd/netherwingcore/proto/client/attribute_types.proto";
import "br/net/dd/netherwingcore/proto/client/entity_types.proto";
import "br/net/dd/netherwingcore/proto/client/friends_types.proto";
import "br/net/dd/netherwingcore/proto/client/invitation_types.proto";
import "br/net/dd/netherwingcore/proto/client/rpc_types.proto";

/**
 * Request for subscribing to friend-related events for a given object.
 */
message SubscribeRequest {
  bgs.protocol.EntityId agent_id = 1;
  uint64 object_id = 2;
  bgs.protocol.ObjectAddress forward = 3 [deprecated = true];
}

/**
 * Request for unsubscribing from friend-related events for a given object.
 */
message UnsubscribeRequest {
  bgs.protocol.EntityId agent_id = 1;
  uint64 object_id = 2;
  bgs.protocol.ObjectAddress forward = 3 [deprecated = true];
}

/**
 * Request to send a friend invitation.
 */
message SendInvitationRequest {
  bgs.protocol.Identity agent_identity = 1;
  bgs.protocol.EntityId target_id = 2;
  bgs.protocol.InvitationParams params = 3;
}

/**
 * Request to revoke a sent invitation.
 */
message RevokeInvitationRequest {
  bgs.protocol.EntityId agent_id = 1;
  uint64 invitation_id = 2;
}

/**
 * Request to accept a received invitation.
 */
message AcceptInvitationRequest {
  bgs.protocol.EntityId agent_id = 1;
  uint64 invitation_id = 3;
  AcceptInvitationOptions options = 4;
}

/**
 * Request to decline an invitation.
 */
message DeclineInvitationRequest {
  bgs.protocol.EntityId agent_id = 1;
  uint64 invitation_id = 3;
}

/**
 * Request to ignore an invitation.
 */
message IgnoreInvitationRequest {
  bgs.protocol.EntityId agent_id = 1;
  uint64 invitation_id = 3;
  uint32 program = 4;
}

/**
 * Request to remove a friend.
 */
message RemoveFriendRequest {
  bgs.protocol.EntityId agent_id = 1;
  bgs.protocol.EntityId target_id = 2;
}

/**
 * Request to revoke all invitations for an agent.
 */
message RevokeAllInvitationsRequest {
  bgs.protocol.EntityId agent_id = 2;
}

/**
 * Request to view friends of a target.
 */
message ViewFriendsRequest {
  bgs.protocol.EntityId agent_id = 1;
  bgs.protocol.EntityId target_id = 2;
}

/**
 * Response containing the list of friends for a ViewFriendsRequest.
 */
message ViewFriendsResponse {
  repeated FriendOfFriend friends = 1;
}

/**
 * Request to update friend's attributes (state).
 */
message UpdateFriendStateRequest {
  bgs.protocol.EntityId agent_id = 1;
  bgs.protocol.EntityId target_id = 2;
  repeated bgs.protocol.Attribute attribute = 3;
}

/**
 * Request to retrieve all friends for an agent.
 */
message GetFriendListRequest {
  bgs.protocol.EntityId agent_id = 2;
}

/**
 * Response containing list of friends for a GetFriendListRequest.
 */
message GetFriendListResponse {
  repeated Friend friends = 1;
}

/**
 * Request to manually create a friendship.
 */
message CreateFriendshipRequest {
  bgs.protocol.EntityId agent_id = 1;
  bgs.protocol.EntityId target_id = 2;
  repeated uint32 role = 3;
}

/**
 * Notification sent when friend is added or removed.
 */
message FriendNotification {
  Friend target = 1;
  bgs.protocol.EntityId account_id = 5;
  bgs.protocol.ObjectAddress forward = 6 [deprecated = true];
}

/**
 * Notification sent when friend state is updated.
 */
message UpdateFriendStateNotification {
  Friend changed_friend = 1;
  bgs.protocol.EntityId account_id = 5;
  bgs.protocol.ObjectAddress forward = 6 [deprecated = true];
}

/**
 * Notification sent when an invitation is received.
 */
message InvitationNotification {
  ReceivedInvitation invitation = 1;
  uint32 reason = 3;
  bgs.protocol.EntityId account_id = 5;
  bgs.protocol.ObjectAddress forward = 6 [deprecated = true];
}

/**
 * Notification sent when an invitation sent by the agent is added.
 */
message SentInvitationAddedNotification {
  bgs.protocol.EntityId account_id = 1;
  SentInvitation invitation = 2;
  bgs.protocol.ObjectAddress forward = 3 [deprecated = true];
}

/**
 * Notification sent when an invitation sent by the agent is removed.
 */
message SentInvitationRemovedNotification {
  bgs.protocol.EntityId account_id = 1;
  uint64 invitation_id = 2;
  uint32 reason = 3;
  bgs.protocol.ObjectAddress forward = 4 [deprecated = true];
}

/**
 * The FriendsService provides RPC methods for managing user friendships.
 */
service FriendsService {
  rpc Subscribe(SubscribeRequest) returns (SubscribeResponse);
  rpc SendInvitation(SendInvitationRequest) returns (bgs.protocol.NoData);
  rpc AcceptInvitation(AcceptInvitationRequest) returns (bgs.protocol.NoData);
  rpc RevokeInvitation(RevokeInvitationRequest) returns (bgs.protocol.NoData);
  rpc DeclineInvitation(DeclineInvitationRequest) returns (bgs.protocol.NoData);
  rpc IgnoreInvitation(IgnoreInvitationRequest) returns (bgs.protocol.NoData);
  rpc RemoveFriend(RemoveFriendRequest) returns (bgs.protocol.NoData);
  rpc ViewFriends(ViewFriendsRequest) returns (ViewFriendsResponse);
  rpc UpdateFriendState(UpdateFriendStateRequest) returns (bgs.protocol.NoData);
  rpc Unsubscribe(UnsubscribeRequest) returns (bgs.protocol.NoData);
  rpc RevokeAllInvitations(RevokeAllInvitationsRequest) returns (bgs.protocol.NoData);
  rpc GetFriendList(GetFriendListRequest) returns (GetFriendListResponse);
  rpc CreateFriendship(CreateFriendshipRequest) returns (bgs.protocol.NoData);
}

/**
 * The FriendListener service provides notifications on friend-related events.
 */
service FriendsListener {
  rpc OnFriendAdded(FriendNotification) returns (bgs.protocol.NO_RESPONSE);
  rpc OnFriendRemoved(FriendNotification) returns (bgs.protocol.NO_RESPONSE);
  rpc OnReceivedInvitationAdded(InvitationNotification) returns (bgs.protocol.NO_RESPONSE);
  rpc OnReceivedInvitationRemoved(InvitationNotification) returns (bgs.protocol.NO_RESPONSE);
  rpc OnSentInvitationAdded(SentInvitationAddedNotification) returns (bgs.protocol.NO_RESPONSE);
  rpc OnSentInvitationRemoved(SentInvitationRemovedNotification) returns (bgs.protocol.NO_RESPONSE);
  rpc OnUpdateFriendState(UpdateFriendStateNotification) returns (bgs.protocol.NO_RESPONSE);
}